<?php
$auth = Zend_Auth::getInstance()->getIdentity();
$auth_user_id = !empty($auth['user_id']) ? $auth['user_id'] : null;
$user = $this->news->findDependentRowset('Application_Model_User')->current();

$image = $this->news->images && file_exists(ROOT_PATH . '/newsimages/' . $this->news->images) ? $this->news->images : null;

if ($image)
{
	list($image_width, $image_height) = getimagesize(ROOT_PATH . '/newsimages/' . $image);
}
?>
<div class="scrpBox scrpBox_new" id="scrpBox_<?php echo $this->news->id; ?>">
	<ul class="myScrp afterClr user_post">
		<?php if ($auth_user_id == $user->id): ?>
		<div class="deteleIcon1">
			<img src="<?php echo BASE_PATH; ?>www/images/delete-icon.png" />
		</div>
		<?php endif; ?>
		<li>
			<ul class="post">
				<li class="imgPro">
					<a href="<?php echo BASE_PATH; ?>home/profile/user/<?php echo $user->id; ?>" style="z-index:9999;">
						<img id="userImage" src="<?php echo $user->getProfileImage(BASE_PATH . 'www/images/img-prof40x40.jpg'); ?>" class="smallImage" /> 
					</a>
				</li>
				<li>
					<?php if ($this->auth): ?>
                    <div class="post-top">
                        <a class="title" href="<?php echo BASE_PATH; ?>home/profile/user/<?php echo $user->id; ?>" style="z-index:9999;color: #0068C4;text-decoration: none;"><?=$this->news_user->Name?></a> 
                        <span class="post-date"><?php echo date("d F Y h:i a", strtotime($this->news->created_date));?></span>
                        <span class="message_number" id="message_success_<?=$this->news->id?>"><?=$this->newsVote?></span>
                        <div id="thumbs_up1_<?=$this->news->id?>"  style="float: right; margin-right: -46px; margin-top: 22px;display:none;">
                            <span id="message_success" style="color: rgb(51, 204, 0);">
                            <img src="<?php echo BASE_PATH; ?>/www/images/correct_small.gif">Thanks!</span>
                         </div>
                         <div id="thumbs_up2_<?=$this->news->id?>"  style="float: right; margin-right: -46px; margin-top: 22px;display:none;">
                            <span id="message_success" style="color: rgb(51, 204, 0);">Already-Voted</span>
                         </div>
                         <div id="thumbsup_blck" class="deteleIcon12" style="display:inline;">
                          <?php if($this->newsVote == 0) { ?>      
                                <img id="img1_<?=$this->news->id?>" class="crp" src="<?=BASE_PATH?>www/images/thumsup_voted_gray.png" <?php if ($user->id != $auth_user_id) { ?> onclick="voting(this, 'news', '<?=$this->news->id?>' ,<?=$auth_user_id?>);" <?php } else { ?> onclick="alert('You can not vote your own post!');" <?php } ?> >
                          <?php } else { ?>     
                                <img id="img1_<?=$this->news->id?>" class="crp" src="<?=BASE_PATH?>www/images/thumsup_voted.jpg" <?php if ($user->id != $auth_user_id) { ?> onclick="voting(this, 'news', '<?=$this->news->id?>' ,<?=$auth_user_id?>);" <?php } else { ?> onclick="alert('You can not vote your own post!');" <?php } ?> >
                          <?php } ?> 
                                <img id="img2_<?=$this->news->id?>" class="crp" style="display: none" src="<?=BASE_PATH?>www/images/thumsup_voted.jpg" <?php if ($user->id != $auth_user_id) { ?> onclick="voting(this, 'news', '<?=$this->news->id?>' ,<?=$auth_user_id?>);" <?php } else { ?> onclick="alert('You can not vote your own post!');" <?php } ?> >
                         </div>
                         <?php if(!isset($auth_user_id)): ?>
                         <div id="thumbsup_blck" class="deteleIcon12" style="display:inline;">
                            <img id="img1" class="voting-popup-class" src="<?=BASE_PATH?>www/images/thumsup_voted.jpg">
                         </div>
                         <?php endif;?>
                    </div>
					<?php endif; ?>
					<div class="post-bottom">
						<div class="post-content"><?php echo $this->news->news_html; ?></div>
					</div>
				</li>
				<li class="clr"></li>
			</ul>
		</li>
		<?php if ($image != null): ?>
		<li class="cmnt">
			<img onclick="openImage('<?php echo $image; ?>', '<?php echo $image_width; ?>', '<?php echo $image_height; ?>');" class="Image-Popup-Class" src="<?php echo BASE_PATH; ?>tbnewsimages/<?php echo $image; ?>" style="width: 100%; height: auto; cursor: pointer;" />
		</li>
		<?php endif; ?>
    </ul>
	<?php if ($this->totalcomments > 5): ?>
	<div class="dur" style="height: 25px;"></div>
	<?php endif;?>
	<ul class="cmntRow afterClr">
        <?php if ($this->totalcomments > 5): ?>
        <li class="viewCount">
			<div class="commentField"><?php echo $this->comentsModel->viewMoreLabel($this->totalcomments - 5); ?></div>
        </li>
        <?php
		endif;

		if ($this->totalcomments)
		{
			for ($i = count($this->comments) - 1; $i >= 0; $i--)
			{
				echo My_ViewHelper::render('comment/item.html', array('item' => $this->comments[$i]));
			}
		}

		echo My_ViewHelper::render('comment/add-item.html')
		?>
    </ul>
</div>
<script type="text/javascript">
	$(function(){
		renderNews($('.scrpBox'));

        newsMap("<?php echo $this->news->latitude; ?>","<?php echo $this->news->longitude; ?>", {
            name: <?php echo json_encode($this->news_user->Name); ?>,
            image: $("#userImage").attr('src'),
            address: <?php echo json_encode($this->news->Address); ?>
        });

        $(".voting-popup-class").colorbox({width:"26%",height:"32%", inline:true, href:"#voting-id"},function(){
            $('html, body').animate({ scrollTop: 0 }, 0); 
        });

        setThisHeight(Number($("#midColLayout").height()+20));

        $(".Image-Popup-Class").colorbox({width:"60%",height:"80%", inline:true, href:"#Image-Popup"},
			function(){$.colorbox.resize({width:imageWidth+'px' , height:imageHeight+'px'});});
    });
</script>
