<?php
$commentsModel = new Application_Model_Comments;
$comments = $commentsModel->findAllByNewsId($this->item->id, 5);
?>
<div id="scrpBox_<?php echo $this->item->id; ?>" class="scrpBox">
<?php
echo My_ViewHelper::render('news/_body.html', array(
	'user' => $this->user,
	'owner' => $this->owner,
	'item' => $this->item
));
?>
	<div class="clr"></div>
	<?php if ($this->item->comment > 5 || $this->user->id == $this->owner->id): ?>
	<div class="dur">
		<div class="news-footer">
			<?php if ($this->item->comment > 5): ?>
			<div class="view-comment"><?php echo $commentsModel->viewMoreLabel($this->item->comment - 5); ?></div>
			<?php endif; ?>
			<?php if ($this->user->id == $this->owner->id): ?>
			<input type="button" class="edit-post" value="Edit Post" />
			<?php endif; ?>
		</div>
		<div class="clr"></div>
	</div>
	<?php endif;?>
	<ul class="cmntRow">
        <?php
		if ($this->item->comment)
		{
			for ($i = count($comments) - 1; $i >= 0; $i--)
			{
				echo My_ViewHelper::render('comment/item.html', array('item' => $comments[$i], 'limit' => 250));
			}
		}

		echo My_ViewHelper::render('comment/add-item.html');
		?>
    </ul>
	<div class="clr"></div>
</div>
<script type="text/javascript">
$(function(){
	renderNewsMap({
		center: new google.maps.LatLng(news.latitude, news.longitude)
	});

	var marker = createNewsMarker({
		map: newsMap,
		position: new google.maps.LatLng(parseFloat(news.latitude), parseFloat(news.longitude)),
		data: news,
		icon: {
			url: baseUrl + 'www/images/icons/icon_1.png',
			width: 25,
			height: 36
		},
		addClass: 'newsMarker'
	}, function(){
		return newsUserTooltipContent(newsOwner.image, newsOwner.name, news.address);
	});

	$(document).click(function(){
		var $markerElement = $('#' + marker.id);

		if ($markerElement.data('ui-tooltip')){
			$markerElement.tooltip('close');
		}
	});

	google.maps.event.addListener(newsMap, 'idle', function(){
		google.maps.event.trigger(marker, 'mouseover');
	});

	renderNews($('.scrpBox'));

	setThisHeight(Number($("#midColLayout").height() + 20));
});
</script>
